<odoo>
    <!-- ACHAT FORM VIEW -->
    <!-- Uses groups attribute on each xpath to apply only to Achat users -->
    <record id="view_entry_form_achat" model="ir.ui.view">
        <field name="name">logistique.entry.form.achat</field>
        <field name="model">logistique.entry</field>
        <field name="inherit_id" ref="logistique.view_logistique_entry_form"/>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            
            <!-- HEADER: Add Workflow (only for Achat users) -->
            <xpath expr="//header" position="inside" groups="achat.group_achat_user,achat.group_achat_manager">
                <button name="action_validate_achat" string="Valider Achat" type="object" class="oe_highlight" 
                        invisible="state != 'draft'"/>
                <field name="state" widget="statusbar" statusbar_visible="draft,validated,in_progress,closed"/>
            </xpath>

            <!-- ACHAT FIELDS: Workflow-based readonly (only for Achat users) -->
            <xpath expr="//field[@name='eta']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='week']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='invoice_number']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='ste_id']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='supplier_id']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='shipping_id']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='article_id']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='details']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='weight']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='price_unit']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='incoterm']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='free_time']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>
            <xpath expr="//field[@name='doc_status']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="readonly">state != 'draft'</attribute>
            </xpath>

            <!-- LOGISTICS FIELDS: Invisible for Achat users -->
            <xpath expr="//field[@name='status']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='remarks']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='saisi_par']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="invisible">1</attribute>
            </xpath>

            <!-- FINANCE FIELDS: Readonly (Visible) for Achat users -->
            <xpath expr="//field[@name='prov_number']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="invisible">0</attribute>
                 <attribute name="readonly">1</attribute>
            </xpath>
            <xpath expr="//field[@name='def_number']" position="attributes" groups="achat.group_achat_user,achat.group_achat_manager">
                 <attribute name="invisible">0</attribute>
                 <attribute name="readonly">1</attribute>
            </xpath>

        </field>
    </record>

    <!-- ACTION ACHAT -->
    <record id="action_achat_entry" model="ir.actions.act_window">
        <field name="name">EntrÃ©es Achat</field>
        <field name="res_model">logistique.entry</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('logistique.view_logistique_entry_tree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('view_entry_form_achat')})]"/>
        <field name="search_view_id" ref="logistique.view_logistique_entry_search"/>
        <field name="context">{'default_state': 'draft'}</field>
    </record>

    <menuitem id="menu_achat_root" name="Achat" sequence="10" web_icon="achat,static/description/icon.png"/>
    <menuitem id="menu_achat_entry" name="Dossiers Achat" parent="menu_achat_root" action="action_achat_entry"/>

</odoo>
