<odoo>
    <!-- Action du rapport -->
    <record id="create_bon_report" model="ir.actions.report">
        <field name="name">Bon de Livraison</field>
        <field name="model">kal3iyasortie</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">kal3iya.bon_report_template</field>
        <field name="report_file">kal3iya.bon_report_template</field>
        <field name="binding_model_id" ref="model_kal3iyasortie"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="base.paperformat_euro"/>
    </record>

    <!-- Template du rapport -->
    <template id="bon_report_template">
        <t t-call="web.html_container">
            <t t-call="web.basic_layout">

                <t t-foreach="grouped_bons" t-as="bon">
                    <div class="page" style="
                        width: 92%;
                        margin: 10px auto;
                        font-family: 'Helvetica', sans-serif;
                        font-size: 17px;
                        line-height: 1.6;
                        color: #000;
                        background-color: #fff;
                        border: 1px solid #ccc;
                        border-radius: 8px;
                        padding: 30px 45px;
                        box-shadow: 0 0 6px rgba(0,0,0,0.1);
                    ">

                        <!-- ===================== EN-TÊTE ===================== -->
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                            <!-- Logo à gauche -->
                            <div style="width:30%; text-align:left;">
                                <t t-if="bon['ste_rec'].logo">
                                    <img t-attf-src="data:image/png;base64,{{bon['ste_rec'].logo}}"
                                         style="max-height:160px; object-fit:contain;"/>
                                </t>
                            </div>

                            <!-- Titre et description au centre -->
                            <div style="width:40%; text-align:center;">
                                <h2 style="margin:0; font-size:24px; letter-spacing:1px; color:#003366;">
                                    <b>BON DE LIVRAISON</b>
                                </h2>
                                <hr style="width:60%; margin:6px auto; border:1px solid #003366;"/>
                                <t t-if="bon['ste_rec'].descrip">
                                    <p style="font-size:14px; color:#555; margin:0;">
                                        <t t-esc="bon['ste_rec'].descrip"/>
                                    </p>
                                </t>
                            </div>

                            <!-- Espace vide à droite pour équilibrer -->
                            <div style="width:30%;"></div>
                        </div>

                        <!-- ===================== TABLEAU INFOS ===================== -->
                        <table style="width:100%; border-collapse:collapse; margin-top:20px; font-size:18px;">
                            <tr style="background:#f0f2f5;">
                                <td style="width:50%; border:1px solid #bbb; padding:8px;">
                                    <b>Société :</b>
                                    <t t-esc="bon['ste'] or ''"/>
                                </td>
                                <td style="width:25%; border:1px solid #bbb; padding:8px;">
                                    <b>Date :</b>
                                    <t t-esc="bon['date'] or ''"/>
                                </td>
                                <td style="width:25%; border:1px solid #bbb; padding:8px;">
                                    <b>Client :</b>
                                    <t t-esc="bon['client'].name or ''"/>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3" style="border:1px solid #bbb; padding:8px;">
                                    <b>Chauffeur :</b>
                                    <t t-esc="bon['driver'].name or ''"/> &#160;
                                    (<t t-esc="bon['driver'].phone or ''"/>)
                                </td>
                            </tr>
                        </table>

                        <!-- ===================== TABLEAU PRODUITS ===================== -->
                        <table style="width:100%; border-collapse:collapse; margin-top:25px; font-size:19px;">
                            <thead>
                                <tr style="background-color:#003366; color:white;">
                                    <th style="border:1px solid #003366; padding:10px; text-align:left;">Désignation</th>
                                    <th style="border:1px solid #003366; padding:10px; text-align:right;">Tonnage (kg)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="bon['lines']" t-as="o">
                                    <tr t-attf-style="background-color: {{'#f9f9f9' if o_index % 2 == 0 else '#fff'}};">
                                        <td style="border:1px solid #ccc; padding:9px;">
                                            <t t-esc="o.quantity"/> sac de <t t-esc="o.name"/> de <t t-esc="o.weight"/>Kg &#160;
                                            <t t-esc="o.dum or ''"/>
                                        </td>
                                        <td style="border:1px solid #ccc; padding:9px; text-align:right;">
                                            <t t-esc="o.tonnage or 0.0"/>Kg
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <!-- ===================== CACHET ===================== -->
                        <div style="text-align:center; margin-top:50px;">
                            <t t-if="bon['ste_rec'].cachee">
                                <img t-attf-src="data:image/png;base64,{{bon['ste_rec'].cachee}}"
                                     style="max-height:180px; object-fit:contain;"/>
                            </t>
                        </div>

                        <!-- ===================== PIED DE PAGE ===================== -->
                        <hr style="border:0; border-top:1px solid #aaa; margin-top:40px;"/>
                        <div style="display:flex; justify-content:space-between; font-size:13px; color:#555; margin-top:5px;">
                            <div>
                                <b><t t-esc="bon['ste']"/></b> — <t t-esc="bon['ste_rec'].adress or ''"/>
                            </div>
                        </div>

                    </div> <!-- /page -->
                </t>

            </t>
        </t>
    </template>
</odoo>